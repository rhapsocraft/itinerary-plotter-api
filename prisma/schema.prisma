generator client {
  provider = "prisma-client-js"
  output   = "../src/db/generated/prisma"
}

generator kysely {
  provider = "prisma-kysely"
  output   = "../src/db"
  fileName = "types.d.ts"
}

generator zod {
  provider = "zod-prisma-types"
  output   = "../src/db/generated/zod"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model NativeUser {
  id            String          @id @default(uuid()) @db.VarChar(36)
  displayName   String
  createdAt     DateTime        @default(now()) @db.Timestamptz(3)
  updatedAt     DateTime        @default(now()) @db.Timestamptz(3)
  files         File[]
  googleAccount GoogleAccount[]
  trips         Trip[]

  @@map("users")
}

model GoogleAccount {
  id          String     @id @default(uuid()) @db.VarChar(36)
  email       String     @unique
  userId      String     @db.VarChar(36)
  createdAt   DateTime   @default(now()) @db.Timestamptz(3)
  updatedAt   DateTime   @default(now()) @db.Timestamptz(3)
  displayName String     @default("")
  user        NativeUser @relation(fields: [userId], references: [id])

  @@map("google_accounts")
}

model Trip {
  id          String     @id @default(uuid()) @db.VarChar(36)
  displayName String     @default("")
  ownerId     String     @db.VarChar(36)
  createdAt   DateTime   @default(now()) @db.Timestamptz(3)
  updatedAt   DateTime   @default(now()) @db.Timestamptz(3)
  owner       NativeUser @relation(fields: [ownerId], references: [id])
  activities  Activity[]
  Document    Document[]

  @@index([ownerId])
  @@map("trips")
}

model Activity {
  id            String     @id @default(uuid()) @db.VarChar(36)
  displayName   String     @default("")
  tripId        String     @db.VarChar(36)
  trip          Trip       @relation(fields: [tripId], references: [id])
  scheduleStart DateTime?  @db.Timestamptz(3)
  scheduleEnd   DateTime?  @db.Timestamptz(3)
  createdAt     DateTime   @default(now()) @db.Timestamptz(3)
  updatedAt     DateTime   @default(now()) @db.Timestamptz(3)
  Document      Document[]

  @@map("activities")
}

model Document {
  id         String                   @id @db.VarChar(36)
  content    String                   @default("")
  createdAt  DateTime                 @default(now()) @db.Timestamptz(3)
  updatedAt  DateTime                 @default(now()) @db.Timestamptz(3)
  tripId     String?                  @db.VarChar(36)
  activityId String?                  @db.VarChar(36)
  activity   Activity?                @relation(fields: [activityId], references: [id])
  trip       Trip?                    @relation(fields: [tripId], references: [id])
  references DocumentFileReferences[]

  @@map("documents")
}

model DocumentFileReferences {
  documentId String   @db.VarChar(36)
  fileId     String   @db.VarChar(36)
  document   Document @relation(fields: [documentId], references: [id])
  file       File     @relation(fields: [fileId], references: [id])

  @@id([documentId, fileId])
  @@map("document_file_ref")
}

model File {
  id          String                   @id @default(uuid()) @db.VarChar(36)
  name        String                   @unique
  displayName String
  src         String
  type        String
  size        Int
  uploaderId  String                   @db.VarChar(36)
  createdAt   DateTime                 @default(now()) @db.Timestamptz(3)
  updatedAt   DateTime                 @default(now()) @db.Timestamptz(3)
  files       DocumentFileReferences[]
  uploader    NativeUser               @relation(fields: [uploaderId], references: [id])

  @@index([uploaderId])
  @@map("files")
}

model user_sessions {
  sid    String   @id(map: "session_pkey") @db.VarChar
  sess   Json     @db.Json
  expire DateTime @db.Timestamp(6)

  @@index([expire], map: "IDX_session_expire")
}
